<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swedish Flashcards</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container" x-data="flashcardApp()" x-init="loadCollections()">
        <!-- Header -->
        <div class="header">
            <h1>Svenska Flashcards</h1>
        </div>

        <!-- Setup Section -->
        <div x-show="!gameStarted" class="section">
            <!-- Tabs -->
            <div class="tabs">
                <button @click="activeTab = 'start'" :class="{ active: activeTab === 'start' }" class="tab">
                    Start
                </button>
                <button @click="activeTab = 'view'" :class="{ active: activeTab === 'view' }" class="tab">
                    View
                </button>
                <button @click="activeTab = 'create'" :class="{ active: activeTab === 'create' }" class="tab">
                    Create
                </button>
                <button @click="activeTab = 'config'" :class="{ active: activeTab === 'config' }" class="tab">
                    Config
                </button>
            </div>

            <!-- Start Tab -->
            <div x-show="activeTab === 'start'">
                <div class="start-grid">
                    <!-- Collection Selector -->
                    <div class="card">
                        <div class="input-group">
                            <label>Select Collection</label>
                            <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                                <select x-model="selectedCollection" @change="loadCollection()" class="select"
                                    style="flex: 1; min-width: 250px;">
                                    <option value="">-- Select a collection --</option>
                                    <template x-for="name in Object.keys(collections)" :key="name">
                                        <option :value="name" x-text="name"></option>
                                    </template>
                                </select>
                                <button @click="deleteCollection()" :disabled="!selectedCollection"
                                    class="btn btn-danger">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- CSV Data -->
                    <div class="card">
                        <div class="input-group">
                            <label>CSV Data</label>
                            <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 1rem;">
                                Format: Swedish,English or Swedish;English (one pair per line)
                            </p>
                            <textarea x-model="csvData" class="textarea"
                                placeholder="Paste your CSV data here or select a collection above..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Start Button -->
                <div class="start-button-container">
                    <button @click="startFlashcards()" class="btn btn-primary"
                        style="padding: 1rem 2rem; font-size: 1.1rem;">
                        Start Flashcards
                    </button>
                </div>
            </div>

            <!-- View Collection Tab -->
            <div x-show="activeTab === 'view'">
                <!-- Collection Selector -->
                <div class="card">
                    <div class="input-group">
                        <label>Select Collection to View</label>
                        <select x-model="selectedCollection" @change="loadCollectionForTable()" class="select">
                            <option value="">-- Select a collection --</option>
                            <template x-for="name in Object.keys(collections)" :key="name">
                                <option :value="name" x-text="name"></option>
                            </template>
                        </select>
                    </div>
                </div>

                <!-- Table View -->
                <div x-show="selectedCollection && flashcards.length > 0" class="table-container">
                    <!-- Search -->
                    <div class="table-search">
                        <input type="text" x-model="searchQuery" @input="filterCards()" class="search-input"
                            placeholder="Search Swedish or English phrases..." />
                    </div>

                    <!-- Table -->
                    <div style="overflow-x: auto;">
                        <table class="flashcard-table">
                            <thead>
                                <tr>
                                    <th style="width: 45%;">Swedish</th>
                                    <th style="width: 55%;">English</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="(card, index) in filteredCards" :key="index">
                                    <tr>
                                        <td>
                                            <div class="swedish-text" style="display: flex; align-items: center;">
                                                <span x-text="card.swedish"></span>
                                                <button
                                                    @click.stop="speakSwedish(card.swedish)"
                                                    :disabled="!speechEnabled()"
                                                    class="btn btn-secondary"
                                                    style="margin-left: 0.5em; flex-shrink: 0; width: 2em; height: 2em; min-width: unset; min-height: unset; display: flex; align-items: center; justify-content: center; padding: 0;">
                                                    ðŸ”ˆ
                                                </button>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="english-text" x-text="card.english"></div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>

                        <!-- No Results -->
                        <div x-show="filteredCards.length === 0 && searchQuery.trim()" class="no-results">
                            No cards found matching "<span x-text="searchQuery"></span>"
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="table-stats">
                        <span x-show="!searchQuery.trim()">
                            Showing <strong x-text="flashcards.length"></strong> cards
                        </span>
                        <span x-show="searchQuery.trim()">
                            Showing <strong x-text="filteredCards.length"></strong> of <strong
                                x-text="flashcards.length"></strong> cards
                        </span>
                    </div>
                </div>

                <!-- Empty State -->
                <div x-show="!selectedCollection" class="card" style="text-align: center; padding: 3rem;">
                    <h3 style="color: #a0a0a0; margin-bottom: 1rem;">ðŸ“š Select a Collection</h3>
                    <p style="color: #666;">Choose a collection from the dropdown above to view its contents in a table
                        format.</p>
                </div>
            </div>

            <!-- Create Tab -->
            <div x-show="activeTab === 'create'">
                <div class="card">
                    <div class="input-group">
                        <label>Collection Name</label>
                        <input type="text" x-model="newCollectionName" class="input"
                            placeholder="Enter collection name...">
                    </div>

                    <div class="input-group">
                        <label>CSV Data</label>
                        <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 1rem;">
                            Format: Swedish,English or Swedish;English (one pair per line)
                        </p>
                        <textarea x-model="newCollectionData" class="textarea"
                            placeholder="Enter your CSV data here..."></textarea>
                    </div>

                    <button @click="saveCollection()" class="btn btn-success" style="width: 100%;">
                        Save Collection
                    </button>
                </div>
            </div>

            <!-- Config Tab -->
            <div x-show="activeTab === 'config'">
                <div class="card">
                    <div class="input-group">
                        <label>Speech (Azure Cognitive Services)</label>
                        <input type="password" x-model="speechKey" class="input"
                            placeholder="Speech key (stored locally)" />
                    </div>
                    <div class="input-group">
                        <div x-data="{ speechRegion: 'swedencentral' }">
                            <input type="text" x-model="speechRegion" class="input"
                                placeholder="Region, e.g., swedencentral" />
                        </div>
                    </div>
                    <button @click="saveSpeechSettings()" class="btn btn-secondary"
                        style="width: 100%; margin-top: 0.5rem;">
                        Save Speech Settings
                    </button>
                    <p style="color:#94a3b8; font-size:0.85rem; margin-top:0.75rem;">
                        Uses your browser's builtâ€‘in voice by default. Optionally configure Azure to use
                        svâ€‘SEâ€‘SofieNeural.
                    </p>
                </div>
            </div>
        </div>

        <!-- Game Section -->
        <div x-show="gameStarted && !sessionComplete" class="section">
            <!-- Stats -->
            <div class="stats-compact-card">
                <span style="color:#667eea; font-weight:600; font-size:1.2rem;" x-text="currentCards.length"></span>
                <span style="color:#888; font-size:0.9rem;">Total</span>
                <span style="margin:0 0.5em; color:#444;">|</span>
                <span style="color:#764ba2; font-weight:600; font-size:1.2rem;" x-text="Math.min(currentIndex + 1, currentCards.length)"></span>
                <span style="color:#888; font-size:0.9rem;">Current</span>
                <span style="margin:0 0.5em; color:#444;">|</span>
                <span style="color:#10b981; font-weight:600; font-size:1.2rem;" x-text="correctAnswers"></span>
                <span style="color:#888; font-size:0.9rem;">Correct</span>
                <span style="margin:0 0.5em; color:#444;">|</span>
                <span style="color:#ef4444; font-weight:600; font-size:1.2rem;" x-text="incorrectCards.length"></span>
                <span style="color:#888; font-size:0.9rem;">Errors</span>
            </div>

            <!-- Flashcard -->
            <div class="flashcard" :class="{ flipped: isFlipped }"
                @click="isFlipped ? markCorrect() : flipCard()">
                <div style="margin-bottom: 0.75rem;">
                    <button @click.stop="speakCurrentSwedish()" :disabled="!speechEnabled()" class="btn btn-secondary">
                        ðŸ”ˆ
                    </button>
                </div>

                <div class="flashcard-word" x-text="getCurrentCardWord()"></div>

                <div x-show="isFlipped" class="flashcard-translation"
                    x-text="getCurrentCardTranslation()"></div>
            </div>

            <!-- Buttons -->
            <div class="buttons">
                <button @click="flipCard()" x-show="!isFlipped" class="btn btn-primary">
                    Show Answer
                </button>
                <button @click="markIncorrect()" x-show="isFlipped" class="btn btn-danger">
                    âœ— Incorrect
                </button>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button @click="resetSession()" class="btn btn-secondary">
                    New Session
                </button>
            </div>
        </div>

        <!-- Session Complete -->
        <div x-show="sessionComplete" class="section">
            <div class="card session-complete">
                <h2 class="session-title">ðŸŽ‰ Session Complete!</h2>
                <p style="font-size: 1.2rem; color: #94a3b8; margin-bottom: 2rem;"
                    x-text="`You got ${correctAnswers} out of ${currentCards.length} cards correct (${Math.round((correctAnswers / currentCards.length) * 100)}%)`">
                </p>

                <div x-show="incorrectCards.length > 0">
                    <h3 style="margin-bottom: 1rem; color: #e2e8f0;">ðŸ“š Cards to review:</h3>
                    <p style="color: #94a3b8; margin-bottom: 1rem;"><em>These are the cards you got wrong - review them
                            to improve!</em>
                    </p>
                    <div class="review-cards">
                        <template x-for="card in incorrectCards" :key="card.swedish + card.english">
                            <div class="review-card">
                                <strong x-text="card.swedish"></strong> â†’ <em x-text="card.english"></em>
                            </div>
                        </template>
                    </div>
                    <div class="buttons">
                        <button @click="startReview()" class="btn btn-primary">
                            ðŸ”„ Review Incorrect Cards
                        </button>
                        <button @click="resetSession()" class="btn btn-secondary">
                            ðŸ†• Start New Session
                        </button>
                    </div>
                </div>

                <div x-show="incorrectCards.length === 0">
                    <h3 style="color: #10b981; margin-bottom: 1rem;">ðŸŽ‰ Perfect Score!</h3>
                    <p style="color: #94a3b8; margin-bottom: 2rem;">You got all cards correct - no need to review!</p>
                    <button @click="resetSession()" class="btn btn-success">
                        ðŸ†• Start New Session
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>